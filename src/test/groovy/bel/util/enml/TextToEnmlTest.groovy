package bel.util.enml

import bel.util.HtmlToPlainText
import com.evernote.edam.type.Note
import com.syncthemall.enml4j.ENMLProcessor
import spock.lang.Specification

/**
 * Created 04.10.2017.
 *
 *
 */
class TextToEnmlTest extends Specification {
    def start = """<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE en-note SYSTEM "http://xml.evernote.com/pub/enml2.dtd"><en-note> """
    def end = """</en-note>"""
    def enmlUmfangreich = """<div><en-todo/>BEL: 28.08.2017 16:40  anrufen</div> <div>BEL: 28.08.2017 16:25  nicht erreicht</div><div><en-todo checked="true"/>BEB: KW15 Edgar Mörtel SS nachtel</div><div>15.03.17: Einladung per pdf durch NIT</div><div><en-todo checked="true"/>BEL: klären mit Hendrik Obenaus, 11.4. &nbsp;23.5.&nbsp;</div><div>Themen: ccpm, Kultur &amp; Fuehrung, Simulation</div><div><br/></div><div><en-todo checked="true"/>NIT: --Herr Mörtl hat sich angemeldet! Winterschool anrufen (12.12. mit Frau Porbley gesprochen. Sie will Hr. Mörtl ansprechen. &quot;gute Ergänzung zum Projekt, wir würden auch was am Preis machen, &nbsp;wenn mehrere MA geschickt werden sollen)</div><div><br/></div><div>NÄCHSTER SCHRITT:</div><div>Projekt bis Juni ist beauftragt am 18.10.16</div><div><br/></div><div><en-todo checked="false"/>BEL:&nbsp;Folgeprojekt abgesichert? 26.7.2017</div><div><en-todo checked="true"/>BEL wirtschaftliche Randbed. klären, Angebot formal, 28.09.16</div><div><en-todo checked="true"/>Termine fixieren (23.9 erster Termin)</div><div><en-todo checked="true"/>NIT:&nbsp;weitere Termine mit Alfred fixieren, 18.10.</div><div><br/></div><div>17.10.16: lt. Anruf Alfred will Hr. Mörtl starten, aber 19.10 passt nicht. Frau Dühring den 27.10 angeboten und um Unterschrift des Angebotes&nbsp;gebeten</div><div>10.10.16: Freitag Angebot zugeschickt. Herr Mörtl <a href="tel:0172-7081653">0172-7081653</a> ist diese Woche in China und meldet sich KW42 bei uns</div><div><br/></div><div><br clear="none"/></div><div><en-media hash="47d05ba2d2c8d7c77e9a5d3617d9a55a" type="application/pdf"/></div><div><br clear="none"/></div><div>Edgar Mörtl:&nbsp;<a href="tel:0172-7081653">0172-7081653</a></div><div><br clear="none"/></div><div>13.09.16: MAW hat kein Angebot abgegeben bisher, fand Herr Mörtl beim LF nicht so toll. BEL kümmert sich jetzt. Mit Alfred und BEN den 23.9 ins Auge gefasst - Impulstag bei Rohwedder. BEL und Mörtl telefonieren heute um 17 Uhr</div><div><br clear="none"/></div><div>19.08.16: Bei MAW nachgefragt wie der Stand ist - Angebot ist noch nicht raus. Soll BEL erst lesen. Es soll trotzdem in KW38 losgehen...</div><div>03.08.16: MAW schreibt Angebot für Alfred und ihn, 30.-40.000, KW38 Start</div><div>29.07.16: lt. MAW soll ich keinen Termin abstimmen. Dafür ist es zu früh. Matthias kümmert sich und medet sich , wenn ich einen Termin abstimmen soll. Er ist mit Herrn Mörtl weiterhin im Gespräch.</div><div><br clear="none"/></div><div>Nicole stimmt Termin mit den Jungs vom IFF auf Basis der Sperrliste ab.</div><div>IFF-spin-off vincent.engineering</div><div><br clear="none"/></div><div>22.06. MAW Termin mit Mörtel am 01. Juli zur Terminierung und Vorgehensweise. Alfred Tenner mit dabei?</div><div><br clear="none"/></div><div><br clear="none"/></div><div>24.05. MAW geht nach Mörtels Urlaub (Anfang Juni) auf ihn zu. Gemeinsamer Termin mit Alfred Tenner in der SW Abteilung. Und Mörtl will zum Lager.Feuer kommen (Redner )</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><br clear="none"/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">nächster Schritt:19.5 gemeinsames AE mit MAW</div><div><br clear="none"/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">27.4 Telefonat mit BEL:</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Ex-Bosch PA, jetzt Rohwedder GF. Kein Economic Buyer! 130 MA.</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">1. er kommt zum Lager.Feuer (NIT eingetragen)</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">2. er versucht, jemand zur SSNM zu schicken 3. und er freut sich über Besuch &quot;Hilfe kann ich gebrauchen&quot;.</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Kritisch. Die haben zu wenig &quot;Masse&quot; für Beratung.Aber mir fährt da immer wieder in den Kopf, ob nicht VIER solche kleinen mit uns EIN Projekt machen können...4X50.000 sind auch 200000 EUR Umsatz und die viele Workshops müsste man nur einmal machen.</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">HEMA hat das so erlebt mit <a href="http://leadaktiv.de/">LEADAKTIV.de</a> - das Konzept halte ich für zukunftsweisend. Naja - mal sehen. Vielleicht sollten wir auf dem Lager.Feuer mal einen solchen Impuls geben.</div><div><br clear="none"/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><br clear="none"/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">20.04.16: BEL und Herr Mörtl haben auf xing geschrieben, nach Absprache mit MAW erst mal Telefontermin mit BEL vereinbaren. Habe ich angefragt und einen Besuchstermin für den 19.5 nach dem Bühler-Termin</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Einladung zur SSNM verschickt.</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Nicole macht Besuchstermin... (warte hier auf Terminoptionen von MAW)</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;"><br clear="none"/></div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Habe Herrn Edgar Moertl auf Xing angefunkt.</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Er ist bei Rohwedder. Die hatten mal 700 Leute und 130 Mio Umsatz, 2008.</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Waren aber auch 2010 Pleite...</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">&nbsp;</div><div style="-en-paragraph: true; margin-top: 1em; margin-bottom: 1em;">Den kennst Du auch noch, oder? Dort könnten wir mal vorbei schauen. Komplexer Anlagenbau.</div>"""
    def enmlSimple = """<div><en-todo/>BEL: 28.08.2017 16:40  anrufen</div> <div>BEL: 28.08.2017 16:25  nicht erreicht</div><div><en-todo checked="true"/>BEB: KW15 Edgar Mörtel SS nachtel</div><div>15.03.17: Einladung per pdf durch NIT</div><div><en-todo checked="true"/>BEL: klären mit Hendrik Obenaus, 11.4. &nbsp;23.5.&nbsp;</div><div>Themen: ccpm, Kultur &amp; Fuehrung, Simulation</div><div><br/></div><div><en-todo checked="true"/>NIT: --Herr Mörtl hat sich angemeldet! Winterschool anrufen (12.12. mit Frau Porbley gesprochen. Sie will Hr. Mörtl ansprechen. &quot;gute Ergänzung zum Projekt, wir würden auch was am Preis machen, &nbsp;wenn mehrere MA geschickt werden sollen)</div><div><br/></div><div>NÄCHSTER SCHRITT:</div><div>Projekt bis Juni ist beauftragt am 18.10.16</div><div><br/></div><div><en-todo checked="false"/>BEL:&nbsp;Folgeprojekt abgesichert? 26.7.2017</div>"""
    def enmlMitSpans ="""<div>*HOT BEL: <a dir="ltr">1.1.2018</a> 50% EUR 50.000 der ist scharf auf V&amp;S. Lagerfeuer betüteln.&nbsp;</div><div><br/></div><div><en-todo checked="false"/>NIT: Termin mit Michael Lässing, GF und BEL/MIK/FAS abstimmen. 04.10</div><div>27.09.17 NIT: Anruf Frau Lücht. Erste Gespräche haben&nbsp;stattgefunden, es gibt aber noch Klärungsbedarf. Sie meldet sich nächste Woche</div><div>21.09.17 NIT: Anruf Frau Lücht. Nächsten Di Gespräch GF abwarten, vorher nix abstimmen. Der 4.10 ist zu früh. 20.10 evtl. Sie ruft Mi wieder an</div><div><br/></div><div><en-todo checked="false"/>BEL:&nbsp;Struktur Dokument Potenzial-Analyse zuschicken<br/></div><div><span style="-webkit-text-size-adjust: 100%;">VORSICHT: Michael ist nicht EB.</span></div><div><span style="-webkit-text-size-adjust: 100%;"><br/></span></div><div>20.9.17 BEL TELEFONAT</div><div>Auf links ziehen...</div><div>2003 70 Mio</div><div>jetzt 100 Mio</div><div>Vorgänger: nie an Strukturen gearbeitet</div><div>Prozesse passen nicht mehr sagt Qler</div><div>auch standard-Produkte wird hinten knapp...</div><div>20 Fehlteile früher -&nbsp;<span style="-webkit-text-size-adjust: 100%;">150 heute</span></div><div>ReleaseManagement... sollte man machen. ABER: keine Zeit</div><div>Alle in Meetings</div><div>&quot;Wachstums-Krise&quot;</div><div><br/></div><div>habe mündlich PA zwisch&nbsp;</div><div>2 Tage - 15000 (quick &amp; dirty)</div><div>und 80000 genannt</div><div>schätze, zwischhen drin, sagte Michael</div><div><br/></div><div>100Mio Umsatz in Spitzenzeiten, derzeit keine Not - aber Tabak, daher neue Marktausrichtung.</div><div>LF-Gespräch. Diese Themen haben angedockt;</div><div>Er hat den Job, Change zu machen - aber keiner zieht mit oder blockiert gar...</div><div>1 Verantwortung ohne Chef</div><div>2 Vielleicht können die Leute Sie nicht leiden</div><div>3 Herausforderung fehlt</div><div><br/></div><div>Herr Lässing nimmt am LF 2017 teil</div><div><br/></div><div><en-todo checked="true"/>BEL: er ist am 4.9. aus Urlaub zurück. dann wegen allsafe nachhaken (Termin passt nicht)</div><div><en-todo checked="true"/>NIT: Denkwerkstatt Feb durch AZA&nbsp;eingeladen? 06.01. AZA FRAGEN. wird eingeladen 10.1 lt. Azra</div><div>22.11.16: AZA sagt sie wollten zur Denkwerkstatt am 18.11 kommen, Termin passt aber nicht. Ausweichtermin auch nicht. AZA hat <a dir="ltr">den 3.2</a>&nbsp;mitgeteilt.&nbsp;</div><div>18.10.16: AZA hat Einladung an Ihn und Assistenz geschickt</div><div><en-todo checked="true"/>&nbsp;BEL: zur Denkwerkstatt einladen, 18.10.</div><div><br/></div><div>20.09.2016: BEL M1 Trlefonat FOCKE, Hr Lässing.</div><div>Er will sich langsam mit V&amp;S bekannt machen. Verbesserungsprojekt steht an. Er hat W&amp;H besucht und war beeindruckt... cooles Telefonat. Nicole ist dran.</div><div><br/></div><div>+49 173 9809329<br/></div><div><br/></div><div>Herr Löffler ruft bitte Herrn Lässing über Frau Lücht an: <a href="tel:+49%204499%2082-198">+49 (0) 4499 82-198</a></div><div><br/></div>"""

    def "TransformToENMLBody simple"() {
        when:
        Note n = new Note()
        n.setContent(start + enmlSimple + end)
        String html = ENMLProcessor.get().noteToInlineHTMLString(n)
        String plainText = HtmlToPlainText.convert(html)
        def enmlBody = TextToEnml.transformToENMLBody(plainText)
        println(plainText)
        then:
        plainText == """TITEL: \n-----------------------\n\n[ ] BEL: 28.08.2017 16:40 anrufen\nBEL: 28.08.2017 16:25 nicht erreicht\n[x] BEB: KW15 Edgar Mörtel SS nachtel\n15.03.17: Einladung per pdf durch NIT\n[x] BEL: klären mit Hendrik Obenaus, 11.4.  23.5. \nThemen: ccpm, Kultur & Fuehrung, Simulation\n\n[x] NIT: --Herr Mörtl hat sich angemeldet! Winterschool anrufen (12.12. mit\nFrau Porbley gesprochen. Sie will Hr. Mörtl ansprechen. "gute Ergänzung zum \nProjekt, wir würden auch was am Preis machen,  wenn mehrere MA geschickt werden\nsollen)\n\nNÄCHSTER SCHRITT:\nProjekt bis Juni ist beauftragt am 18.10.16\n\n[ ] BEL: Folgeprojekt abgesichert? 26.7.2017"""
        //enmlBody == enmlSimple //"""<div><en-todo checked="false"></en-todo> BEL: 28.08.2017 16:40 anrufe</div><div>BEL: 28.08.2017 16:25 nicht erreich</div><div><en-todo checked="true"></en-todo> BEB: KW15 Edgar Mörtel SS nachte</div><div>15.03.17: Einladung per pdf durch NI</div><div><en-todo checked="true"></en-todo> BEL: klären mit Hendrik Obenaus, 11.4.  23.5.</div><div>Themen: ccpm, Kultur &amp; Fuehrung, Simulatio</div><div><br/></div><div><br/></div><div><br/></div><div><en-todo checked="true"></en-todo> NIT: --Herr Mörtl hat sich angemeldet! Winterschool anrufen (12.12. mit</div><div>Frau Porbley gesprochen. Sie will Hr. Mörtl ansprechen. &quot;gute Ergänzung zum</div><div>Projekt, wir würden auch was am Preis machen,  wenn mehrere MA geschickt werden</div><div>sollen</div><div><br/></div><div><br/></div><div><br/></div><div>NÄCHSTER SCHRITT</div><div>Projekt bis Juni ist beauftragt am 18.10.1</div><div><br/></div><div><br/></div><div><br/></div><div><en-todo checked="false"></en-todo> BEL: Folgeprojekt abgesichert? 26.7.201</div><div></div>"""
    }

    def "TransformToENMLBody span-elements (opening and closing) and href (phone) "() {
        when:
        Note n = new Note()
        n.setContent(start + enmlMitSpans + end)
        String html = ENMLProcessor.get().noteToInlineHTMLString(n)
        String plainText = HtmlToPlainText.convert(html)
        def enmlBody = TextToEnml.transformToENMLBody(plainText)
        println(plainText)
        then:
        plainText == """"""
        //enmlBody == enmlSimple //"""<div><en-todo checked="false"></en-todo> BEL: 28.08.2017 16:40 anrufe</div><div>BEL: 28.08.2017 16:25 nicht erreich</div><div><en-todo checked="true"></en-todo> BEB: KW15 Edgar Mörtel SS nachte</div><div>15.03.17: Einladung per pdf durch NI</div><div><en-todo checked="true"></en-todo> BEL: klären mit Hendrik Obenaus, 11.4.  23.5.</div><div>Themen: ccpm, Kultur &amp; Fuehrung, Simulatio</div><div><br/></div><div><br/></div><div><br/></div><div><en-todo checked="true"></en-todo> NIT: --Herr Mörtl hat sich angemeldet! Winterschool anrufen (12.12. mit</div><div>Frau Porbley gesprochen. Sie will Hr. Mörtl ansprechen. &quot;gute Ergänzung zum</div><div>Projekt, wir würden auch was am Preis machen,  wenn mehrere MA geschickt werden</div><div>sollen</div><div><br/></div><div><br/></div><div><br/></div><div>NÄCHSTER SCHRITT</div><div>Projekt bis Juni ist beauftragt am 18.10.1</div><div><br/></div><div><br/></div><div><br/></div><div><en-todo checked="false"></en-todo> BEL: Folgeprojekt abgesichert? 26.7.201</div><div></div>"""
    }
}
